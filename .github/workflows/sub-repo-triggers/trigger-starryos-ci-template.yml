# å­ä»“åº“ CI è§¦å‘æ¨¡æ¿
#
# ä½¿ç”¨æ–¹æ³•ï¼š
# 1. å°†æ­¤æ–‡ä»¶å¤åˆ¶åˆ°å­ä»“åº“çš„ .github/workflows/ ç›®å½•
# 2. æ›¿æ¢ REPO_NAME ä¸ºå®é™…çš„ä»“åº“åï¼ˆå¦‚ arceosã€axcpu ç­‰ï¼‰
# 3. ç¡®è®¤ DEV_BRANCH æ˜¯å¦ä¸º devï¼ˆæŸäº›ä»“åº“å¯èƒ½æ˜¯ mainï¼‰
# 4. åœ¨å­ä»“åº“æ·»åŠ  secret: STARRYOS_CI_TOKEN

name: Trigger StarryOS CI

on:
  pull_request:
    branches:
      - dev  # æ ¹æ®å®é™…æƒ…å†µä¿®æ”¹ï¼ˆæŸäº›ä»“åº“å¯èƒ½æ˜¯ mainï¼‰
    types: [opened, synchronize, reopened]

jobs:
  trigger-starryos:
    runs-on: ubuntu-latest
    steps:
      - name: Trigger StarryOS CI
        uses: peter-evans/repository-dispatch@v3
        with:
          token: ${{ secrets.STARRYOS_CI_TOKEN }}
          repository: kylin-x-kernel/StarryOS
          event-type: sub-repo-pr
          client-payload: |
            {
              "trigger_repo": "REPO_NAME",
              "trigger_sha": "${{ github.event.pull_request.head.sha }}",
              "trigger_ref": "${{ github.event.pull_request.head.ref }}",
              "trigger_pr": "${{ github.event.pull_request.number }}",
              "trigger_title": "${{ github.event.pull_request.title }}"
            }
          
      - name: Comment on PR
        uses: actions/github-script@v7
        with:
          script: |
            github.rest.issues.createComment({
              issue_number: context.issue.number,
              owner: context.repo.owner,
              repo: context.repo.repo,
              body: 'ğŸš€ StarryOS CI has been triggered for this PR.\n\nView the results at: https://github.com/kylin-x-kernel/StarryOS/actions'
            })
